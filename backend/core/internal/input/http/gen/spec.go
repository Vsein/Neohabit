// Package gen provides primitives to interact with the openapi HTTP API.
//
// Code generated by github.com/oapi-codegen/oapi-codegen/v2 version v2.5.1 DO NOT EDIT.
package gen

import (
	"bytes"
	"compress/gzip"
	"encoding/base64"
	"fmt"
	"net/url"
	"path"
	"strings"

	"github.com/getkin/kin-openapi/openapi3"
)

// Base64 encoded, gzipped, json marshaled Swagger object
var swaggerSpec = []string{

	"H4sIAAAAAAAC/8xXUVPbOBf9Kxp938PujEOc1MlC3oB028x0djq0fWp5uMjXsTqyZKRrwMP4v+9IdpIS",
	"O21ZGFpewLakc+65R0fingtTlEajJscX99yJHAsIf55bBMK3cCXpAq8rdOTfltaUaEliGJOiE1aWJI3u",
	"PfLl7omZjFGOLKzGI453UJQK+YJ/zKVj0jFgLrzaDing7h3qNeV8MYmnScSpLv0ER1bqNW8irqHAPuo/",
	"UOBhuA8HQaazecQLqbegPcQm4havK2kx5YvPLXz0AP1yO8dcfUVBnuVra429QFca7bCvIPrP/SreVgXo",
	"kUVI4UohC6NYgc7BGh8UFCph2hDLTKVT/iPWLd4Q0VaTHkFh1BDBc//6sM7/m746O1+e7fcxHmijCD5L",
	"T6kP8knLO0ayQEdQlOyPQiolHQqjU/cnu81Rt9DsFhzr1vmWxmQenySzk2nsfyKeGVsA8QWXmubJTiqp",
	"CddoPZlfaui0wiUQPkEH6VhaYcScGQlQClO2NqCeJolMPaH/W8x8X8e7vBh3YTEO2Kvlr9iTEa/K9Fns",
	"o8AR6xZ7mmCVQ7v6oWif/Khlb39KD96t0Ml5cLOuloM1X1fIZIqaZCbRsszYAdFnsxiPkzge4fTkapRM",
	"0mQEf03moySZz2ezJPHV8gG5O9o/ietHPwOsF0nqzPRhL15/+MhO368CmjAWmUN7IwWyzChlbqVes3OF",
	"oNmpFbkkFFRZZCUQodVHX/QFlgoEbowgKWe1qSwDQRUo5quhmvk+HH3RnpmkUEjAOn2/4hG/QetaNpOj",
	"+Cj2KpkSNZSSL/ir8CriJVAe8nScb3J2jeGXD1vw5XjP8HfSUeDiwiQLBRJaxxef90v/WypCy65q5koU",
	"MpOCrZZ+lvRfryu09cZBCy5T/6X1ngeVhIV7xL7uGgLWQs2b5tKbtj3SwirTOG7PCk2oQ1VQlkqKUNf4",
	"q2vT9L/AD4Dvx3TQzMdLp1sT8dkj+XyPxsMDfAB+pb2XQAXroW0P67CxXVUUYOsNxW1fCda+o7y1wmUT",
	"8dK4ATN8cwXjbUygozOT1s9W3MAlr3kYSWQrbHrtnjwbg63J+sK2e7I715mrhEDnskqp2vc4edke34CS",
	"Ket6wFIgaEmcvByJVg9Q/lpYM7yT7jd1e+uq7amzb/cm6lJwfJ+33W8O5uEbpM0y303D7v6zPX42Oehz",
	"dxeDHRzfN3j0aLM+NQF/IvgOGaC96AfzJS9tvt0/Gr+j795gF7L+VAxt7lnPjw8LtCaqrPK2ICoX47Ey",
	"AlRuHC2O4+OY+x5384fdVoCGNRaoiW1N6/bMxpvL5t8AAAD//5efQK1lDwAA",
}

// GetSwagger returns the content of the embedded swagger specification file
// or error if failed to decode
func decodeSpec() ([]byte, error) {
	zipped, err := base64.StdEncoding.DecodeString(strings.Join(swaggerSpec, ""))
	if err != nil {
		return nil, fmt.Errorf("error base64 decoding spec: %w", err)
	}
	zr, err := gzip.NewReader(bytes.NewReader(zipped))
	if err != nil {
		return nil, fmt.Errorf("error decompressing spec: %w", err)
	}
	var buf bytes.Buffer
	_, err = buf.ReadFrom(zr)
	if err != nil {
		return nil, fmt.Errorf("error decompressing spec: %w", err)
	}

	return buf.Bytes(), nil
}

var rawSpec = decodeSpecCached()

// a naive cached of a decoded swagger spec
func decodeSpecCached() func() ([]byte, error) {
	data, err := decodeSpec()
	return func() ([]byte, error) {
		return data, err
	}
}

// Constructs a synthetic filesystem for resolving external references when loading openapi specifications.
func PathToRawSpec(pathToFile string) map[string]func() ([]byte, error) {
	res := make(map[string]func() ([]byte, error))
	if len(pathToFile) > 0 {
		res[pathToFile] = rawSpec
	}

	return res
}

// GetSwagger returns the Swagger specification corresponding to the generated code
// in this file. The external references of Swagger specification are resolved.
// The logic of resolving external references is tightly connected to "import-mapping" feature.
// Externally referenced files must be embedded in the corresponding golang packages.
// Urls can be supported but this task was out of the scope.
func GetSwagger() (swagger *openapi3.T, err error) {
	resolvePath := PathToRawSpec("")

	loader := openapi3.NewLoader()
	loader.IsExternalRefsAllowed = true
	loader.ReadFromURIFunc = func(loader *openapi3.Loader, url *url.URL) ([]byte, error) {
		pathToFile := url.String()
		pathToFile = path.Clean(pathToFile)
		getSpec, ok := resolvePath[pathToFile]
		if !ok {
			err1 := fmt.Errorf("path not found: %s", pathToFile)
			return nil, err1
		}
		return getSpec()
	}
	var specData []byte
	specData, err = rawSpec()
	if err != nil {
		return
	}
	swagger, err = loader.LoadFromData(specData)
	if err != nil {
		return
	}
	return
}
